<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="handlebars.min-v4.7.7.js"></script>
  </head>
  <body>
    <script>
      Handlebars.registerHelper("ifeq", function (a, b, options) {
        return a === b ? options.fn(this) : options.inverse(this);
      });

      Handlebars.registerHelper("ifnoteq", function (a, b, options) {
        return a !== b ? options.fn(this) : options.inverse(this);
      });

      Handlebars.registerHelper("ifnotend", function (a, b, options) {
        return a < b - 1 ? options.fn(this) : options.inverse(this);
      });

      Handlebars.registerHelper("switch", function (value, options) {
        this.switch_value = value;
        return options.fn(this);
      });

      Handlebars.registerHelper("case", function (value, options) {
        if (value == this.switch_value) {
          return options.fn(this);
        }
      });

      Handlebars.registerHelper("default", function (value, options) {
        return options.fn(this);
      });

      window.addEventListener("message", (event) => {
        console.log("iframe message", event);
        const compiled = Handlebars.compile(event.data.template)(
          event.data.context
        );

        event.source.postMessage(
          { action: "update-template", result: compiled },
          event.origin
        );
      });
    </script>
  </body>
</html>
